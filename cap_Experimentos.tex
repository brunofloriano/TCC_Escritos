%TCIDATA{LaTeXparent=0,0,relatorio.tex}
                      
\chapter{Resultados Experimentais}\label{CapExperimentos}

% Resumo opcional. Comentar se não usar.
\resumodocapitulo{Resumo opcional.}

\section{Introdução}

%Na introdução deverá ser feita uma descrição geral dos experimentos realizados. 

%Para cada experimentação apresentada, descrever as condições de experimentação (e.g., instrumentos, ligações específicas, configurações dos programas), os resultados obtidos na forma de tabelas, curvas ou gráficos. Por fim, tão importante quando ter os resultados é a análise que se faz deles. Quando os resultados obtidos não forem como esperados, procurar justificar e/ou propor alteração na teoria de forma a justificá-los.

Como foi abordado no Capítulo \ref{CapDesenvolvimento}, o desenvolvimento do projeto sofreu modificações com relação à concepção inicial do controle de estabilidade. As principais mudanças, assim como a determinação dos coeficientes de resposta dos motores, foram baseadas em testes reais na plataforma, que serão mostrados e analisados neste capítulo.

Os experimentos consistiram na execução do programa elaborado para cada etapa do desenvolvimento do controle com o robô nos seguintes cenários: sustentado por uma caixa, sem contato das patas com o solo; com o robô em pé se sustentando, mas sem nenhum distúrbio e, por fim, sendo empurrado para a esquerda, direita, para frente ou para trás.

Após cada experimento, os dados eram recolhidos e analisados através do software \emph{Matlab}. Os gráficos que serão apresentados neste capítulo foram obtidos por tal programa.

\section{Modo Velocidade}
A primeira abordagem do controle de estabilidade foi a utilização dos motores no modo velocidade. Nesta seção serão apresentados os principais resultados obtidos neste modo de operação e analisadas as suas consequências para o controle de estabilidade.

\subsection{Medição}
O primeiro elemento a ser testado é a medição dos ângulos pelo acelerômetro. Além disso, pode-se obter a velocidade dos ângulos de rolagem e arfagem através da derivação e observar os efeitos do filtro passa-baixa desenvolvido.


O teste é feito com o robô parado, sustentado por uma caixa que impede as patas de entrarem em contato com o solo, sem a adição de qualquer distúrbio e com a resposta dos motores desativada. Dessa forma, é possível observar o ruído produzido durante a medição, uma vez que os dados de velocidade, em um cenário ideal, deveriam ser iguais a zero e os ângulos, sempre constantes. Podemos observar a medição destes na Figura \ref{fig:angulos_ruido}.

\begin{figure} [!b]
	\centering
	\includegraphics[width=0.6\textwidth]{Figuras/Angulos_ruido}
	\caption{Ângulos de Rolagem e Arfagem medidos com o robô parado}
	\label{fig:angulos_ruido}
\end{figure}

Os ângulos iniciam o teste com os valores iniciais de zero graus, devido à inicialização da conexão com o \emph{Arduino}. No entanto, após 6 períodos de amostragem (ou 1.2 segundos) a aquisição de dados é estabelecida. A partir de então, podemos notar que os dados sofrem variações devido ao ruído. Utilizando os comandos \emph{max}, \emph{min} e \emph{mean} do \emph{Matlab} podemos identificar os ângulos mínimo, máximo e médio atingidos para cada medição. Tais valores são apresentados na Tabela \ref{TabAngulos}. 

Podemos observar que o valor médio das duas quantidades é diferente de zero, apesar de muito próximos deste valor, indicando uma pequena inclinação da superfície em que o robô é instalado. A variação de cada ângulo medido a cada período de amostragem é um efeito do ruído de medição, caracterizado por altas frequências.

Após a medição, os ângulos são derivados e, em seguida, passados por um filtro passa-baixa, especificado pela equação (\ref{eq:filtro}). As velocidades resultantes após a derivação e após a filtragem podem ser visualizadas na Figura \ref{fig:velocidades_medidas}. Para poder analisar o efeito do filtro sobre a velocidade calculada, montou-se a Tabela \ref{TabVelocidades}. Nela foram organizados os valores mínimo, máximo e médio das velocidades assim como sua amplitude, ou seja, a diferença entre o máximo e o mínimo atingidos.

Dessa forma, podemos observar que, com a inclusão do filtro, a amplitude do ruído decaiu 45.7\% para a medição da velocidade de rolagem e 52.5\% para a arfagem. Isso indica que o efeito do filtro sob a medição da velocidade se mostrou adequado para as necessidades para as quais ele foi desenvolvido. Isto é, ele é capaz de amenizar a ação do ruído em altas frequências.

Por fim, pode-se observar que o valor médio das velocidades obtidas encontra-se na ordem de $10^{-4}$ e $10^{-5}$ e, dessa forma, reduzidos o bastante para serem considerados próximos de zero. Como será visto mais adiante, um distúrbio no sentido de rolagem, por exemplo, permanece na ordem de $10^{0}$ e $10^{1}$ rad/s.

\begin{table}[t]
	\caption{Ângulos mínimo, máximo e médio medidos}
	\label{TabAngulos}
	\begin{center}
		\begin{tabular}{|c|c|c|c|}
			\hline
			\textbf{Orientação} & \textbf{Valor mínimo (graus)} & \textbf{Valor máximo (graus)} & \textbf{Valor médio (graus)} \\
			\hline
			Rolagem & 0.6663 & 1.3429 & 0.9947\\
			Arfagem & -0.3531 & 0.3237 & -0.0849\\ \hline
		\end{tabular}
	\end{center}
\end{table}


\begin{figure}[!b]
	\centering
	\mbox{
		\subfigure[Velocidade de Rolagem]{\includegraphics[width=0.5\textwidth]{Figuras/Filtro_roll}}\quad\quad
		\subfigure[Velocidade de Arfagem]{\includegraphics[width=0.5\textwidth]{Figuras/Filtro_pitch}}}
	\caption{Velocidades antes e depois da filtragem}
	\label{fig:velocidades_medidas}
\end{figure}

\subsection{Posição Inicial}
Um dos elementos fundamentais nos experimentos que serão realizados é que o robô inicie cada procedimento em uma posição inicial adequada. Determinou-se que tal disposição consistia nas patas perpendiculares à base do robô, sustentando-o através de um arranjo retangular.

Para obter tal posição realizou-se um breve procedimento em que os motores foram desprovidos de qualquer resposta (para tal, configurou-se o torque limite de todos os motores como zero) e, então, cada motor foi manualmente rearranjado de modo que as quatro patas ficassem perpendicular ao plano da base do robô. Em seguida, foi feita a leitura da posição de todos os motores. Essas leituras podem ser visualizadas na Tabela \ref{TabPosicaoInicial}.


\begin{table}[t]
	\caption{Velocidades mínima, máxima, média e sua amplitude}
	\label{TabVelocidades}
	\begin{center}
		\begin{tabular}{c|c|c|c|c}
			\hline
			\textbf{Orientação} & \textbf{Mínimo (rad/s)} & \textbf{Máximo (rad/s)} & \textbf{Amplitude (rad/s)} & \textbf{Média (rad/s)} \\
			\hline
			Rolagem & -0.0581 & 0.1172 & 0.1753 & $7.0738*10^{-4}$\\
			Rolagem filtrada & -0.0299 & 0.0952 & 0.0653 & $7.0598*10^{-4}$\\
			Arfagem & -0.0399 & 0.0409 & 0.0808 & $8.3171*10^{-5}$\\
			Arfagem filtrada & -0.0184 & 0.0384 & 0.02 & $2.9474*10^{-5}$\\ \hline
		\end{tabular}
	\end{center}
\end{table}

\begin{table}[!b]
	\caption{Posição Inicial dos Motores}
	\label{TabPosicaoInicial}
	\begin{center}
		\begin{tabular}{|c|c|c|}
			\hline
			\textbf{Motor} & \textbf{Ângulo inicial (valor quantizado)} & \textbf{Ângulo inicial (graus)} \\
			\hline
			1 & 497 & 145.7\\
			2 & 498 & 146\\
			3 & 503 & 147.5\\
			4 & 132 & 38.7\\
			5 & 543 & 159.2\\
			6 & 521 & 152.8\\
			7 & 540 & 158.4\\
			8 & 527 & 154.5\\
			9 & 347 & 101.8\\
			10 & 497 & 145.7\\
			11 & 549 & 161\\
			12 & 500 & 146.6\\ \hline
		\end{tabular}
	\end{center}
\end{table}

Com estes valores, foi possível adicionar na função \emph{main} do código, comandos que, na inicialização do procedimento, coloquem cada motor na sua posição inicial. Para fazer isso no modo velocidade, criou-se as funções para acionar cada modo de operação (posição ou velocidade). Portanto, ao iniciar o código, a \emph{main} aciona o modo posição, aloca cada junta na sua posição inicial e, em seguida, retorna ao modo velocidade para acionar o controle. Quando trabalharmos no modo posição, mais a frente, não será necessário retornar ao modo velocidade.

Podemos visualizar a posição inicial do robô na Figura 	\ref{fig:roboreal2}.

\subsection{Teste de Sustentação} \label{sec:sustentacao_velocidade}
Com as medições realizadas, os procedimentos seguintes envolvem o robô parado, sustentado pelas suas próprias patas e sem a aplicação de nenhum distúrbio externo. Para tal, o sistema implementado, inicialmente, impõe as posições iniciais de cada motor de modo que o robô fique na postura adequada. Em seguida, a plataforma é posicionada sobre solo e nenhum distúrbio (e.g. empurrão) é aplicado. Este experimento foi realizado, para fins de comparação, tanto para o controle desenvolvido para o modo velocidade, caracterizado pela equação (\ref{eq:controle_velocidade_discreto}), como para o controle adaptado para o modo posição, determinado pela equação (\ref{eq:controle_posicao_discreto}), que será abordado mais adiante.


O resultado obtido no modo velocidade pode ser visualizado pela Figura \ref{fig:teste_sustentacao}. Na Fig. \ref{fig:teste_sustentacao}(a) são mostrados os ângulos de rolagem e arfagem medidos. Já a Fig. \ref{fig:teste_sustentacao}(b) apresenta, em vermelho, a velocidade de rolagem e, de amarelo, a velocidade dos motores utilizados para corrigir o distúrbio nesta direção (i.e. motores 1, 4, 7 e 10). Analogamente, a Fig. \ref{fig:teste_sustentacao}(b) contém a velocidade de arfagem e dos respectivos motores que a corrigem.

Podemos notar uma grande movimentação entre os instantes 1 e 3 segundos mas que se devem apenas à alocação do robô sobre o solo. A partir deste momento, nenhum distúrbio externo foi aplicado ao robô. Ainda assim, é possível observar, na Fig. \ref{fig:teste_sustentacao}(a), que o robô sofre uma queda, a partir de aproximadamente 8 segundos, quando o ângulo de arfagem caiu para -18.3 graus.


\begin{figure} [t]
	\centering
	\includegraphics[width=0.6\textwidth]{Figuras/robo_real2}
	\caption{Robô na sua posição inicial}
	\label{fig:roboreal2}
\end{figure}

\begin{figure}[b]
	%\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_velocidade1}}\quad\quad
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_velocidade2}}
		\subfigure[Velocidade de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_velocidade3}}}
	\caption{Teste de Sustentação do Robô}
	\label{fig:teste_sustentacao}
\end{figure}


Para analisar o ocorrido podemos verificar a Fig. \ref{fig:teste_sustentacao}(c), representando a direção em que houve a queda (i.e arfagem). Nela, as linhas em amarelo, representando as velocidades dos motores, começam a aumentar (em módulo) alguns segundos antes da queda brusca. Este é um indicador de que as juntas começaram a ceder inicialmente de forma lenta e foram aumentando sua velocidade até que o robô não foi mais capaz de se sustentar, gerando a queda.

Podemos, para melhor visualização, separar a resposta de um desses motores, como é feito na Figura \ref{fig:motor_queda}. Nesta imagem, isolou-se a resposta, em módulo, do motor 11 (utilizado para corrigir a arfagem em uma junta do tipo não joelho). Constata-se que a velocidade do motor começou a aumentar cerca de 2 segundos antes da queda do robô, atingindo o seu ápice por volta de 8.4 segundos.

\begin{figure} [t]
	\centering
	\includegraphics[width=0.6\textwidth]{Figuras/Modo_velocidade4}
	\caption{Velocidade do Motor 11}
	\label{fig:motor_queda}
\end{figure}



Como não houve distúrbios externos e a resposta dos motores havia sido configurada para 0 rad/s, conclui-se que os motores não apresentam torque suficiente no modo velocidade para mantê-la como tal e, consequentemente, deixam as juntas suscetíveis a serem movimentadas. O resultado disso foi o peso do robô movimentar as juntas até o ponto em que este não foi capaz de se sustentar mais.

No entanto, não foi encontrado o motivo pelo qual os motores apresentam um torque limitado no modo velocidade. Pode-se salientar que os motores foram configurados para apresentarem o torque máximo possível. Para tal, os bytes 14 e 15 da memória de cada motor definem o torque máximo permitido e, os bytes 34 e 35, o limite de torque que se deseja implementar. Nos dois casos foram aplicados os maiores valores possíveis para garantir que não houvesse limitações de torque. Ainda assim, os testes no modo velocidade apresentaram as limitações verificadas anteriormente.

A hipótese formulada para tal limitação é que o modo velocidade foi desenvolvido pelos fabricantes dos motores para ser utilizado em rodas ou outros elementos que giram constantemente por várias revoluções por minuto. Enquanto isso, o modo posição teria sido desenvolvido para aplicações em articulações e juntas, como é o caso do quadrúpede, uma vez que a determinação (e fixação) das posições desejadas implica em uma resolução de movimento mais adequada para tais finalidades. Por isso, este modo apresentaria um torque mais elevado para manter as posições fixas enquanto, em rodas e afins, esta imobilização não se faz necessária.

Como será visto na próxima seção, o modo posição apresenta um torque bastante elevado quando comparado ao modo velocidade. Neste caso, ao determinar uma posição para o motor (assim como configuramos uma velocidade de 0 rad/s no modo velocidade) este fixa tal localização e não cede facilmente a movimentos externos que tendam a mover a junta para uma posição diferente. Portanto, é mais vantajoso que trabalhemos no modo posição para que o robô possa se sustentar sozinho.

\section{Modo Posição}
Com o modo posição, podemos utilizar os motores de forma mais adequada para que o robô se sustente e corrija os distúrbios aos quais está suscetível. Da mesma forma que no modo velocidade, nesta seção abordar-se-á os resultados atingidos com os experimentos no modo posição analisando o que necessita de modificação e, principalmente, obtendo os dados empíricos para a determinação das constantes de controle.

\subsection{Teste de Sustentação}
Assim como foi realizado na seção \ref{sec:sustentacao_velocidade}, neste experimento realizou-se o teste de sustentação, com o robô em pé, parado, sem aplicação de distúrbios externos e com a velocidade dos motores configurada para zero. A diferença entre o presente experimento e o item mencionado é que para manter a velocidade de 0 rad/s em cada motor no modo posição, o sistema configura sua localização sempre com o mesmo valor enquanto, anteriormente, a própria velocidade era determinada.

Os dados obtidos para tal teste podem ser analisados pela Figura \ref{fig:teste_sustentacao_posicao}. Podemos observar que o experimento foi possível de ser realizado por mais tempo que anteriormente pois não houve a queda do robô. Dessa forma, as figuras apresentadas apresentam apenas ruído, uma vez que não houve distúrbios externos e nem movimento da juntas.


\begin{figure}[b]
	%\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_posicao1}}\quad\quad
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_posicao2}}
		\subfigure[Velocidade de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_posicao3}}}
	\caption{Teste de Sustentação do Robô no Modo Posição}
	\label{fig:teste_sustentacao_posicao}
\end{figure}


Desta maneira, comparando com os dados obtidos na seção \ref{sec:sustentacao_velocidade}, podemos concluir que a sustentação no modo posição é mais adequada para a plataforma do que no modo velocidade, uma vez que possibilita que o robô fique em pé parado.

\subsection{Determinação das constantes $K_{up}$ e $K_{down}$}
As constantes $K_{up}$ e $K_{down}$, no escopo de correção do movimento de arfagem, tem a finalidade de diferenciar as respostas dos motores de juntas do tipo joelho (com o ganho $K_{up}$) das demais ($K_{down}$). Como mencionado na seção \ref{sec:ganhos}, cada um deses motores terá, ainda, uma segunda componente que será a responsável pelo movimento de correção em si. Dessa forma, $K_{up}$ e $K_{down}$ são apenas ponderações da resposta para a diferenciação das juntas do tipo joelho.

Por esse motivo e para simplificação, considerou-se, inicialmente, que $K_{up} = 1$. Assim, podemos determinar empiricamente o ganho $K_{down}$ em conformidade com o movimento do motor de cima, para que o deslocamento da pata no sentido sagital seja tal que esta aterrisse da forma mais vertical possível como mostrado na Fig. \ref{fig:aterrissagem}(c). Assim, a correção da estabilidade do robô será determinada unicamente pelos ganhos $K_F$ e $K_B$, abordados mais adiante.

O teste para se determinar $K_{down}$ ocorrerá da seguinte forma: aplicaremos um distúrbio no sentido que o faria cair para a frente. Então, com o controlador desenvolvido até este ponto, a correção deve ser feita através dos motores da frente. Testaremos, aos poucos, diferentes valores de $K_{down}$ baseados na resposta final das juntas do tipo joelho em conformidade com o motor de cima. Isto é, se ao final da correção do distúrbio, as patas da frente apresentarem uma configuração de aterrissagem com um ângulo muito distante do eixo vertical, modificar-se-á o valor de $K_{down}$, diminuindo-o ou aumentando-o, de forma que esta aterrissagem seja o mais próxima do eixo vertical possível.


Os testes foram realizados com os valores das constantes $K_F$ e $K_B$ iguais a 1.5. Estes valores foram determinados empiricamente através de testes que serão descritos mais adiante, mas em suma, eles garantem que a resposta do robô seja de tal forma a se equilibrar frente a distúrbios aplicados na direção de arfagem.

O primeiro valor testado para $K_{down}$ foi de -1. Cabe lembrar que o valor negativo de $K_{down}$ se justifica pelo movimento contrário desejado para as juntas tipo joelho em relação ao imposto pelos motores de cima. Dessa forma a pata pode aterrissar de forma vertical. Ao final do distúrbio aplicado com este valor, observou-se que a postura da plataforma se encontrava conforme a Figura \ref{fig:kdown10}.

\begin{figure} [b]
	\centering
	\includegraphics[width=0.6\textwidth]{Figuras/Kdown10}
	\caption{Postura após distúrbio com $K_{down} = -1$}
	\label{fig:kdown10}
\end{figure}

Podemos observar, através desta imagem, que o movimento dos joelhos do robô deslocou as patas muito para trás, fazendo com que o ângulo entre a parte de baixo da pata e a linha vertical atingisse um valor muito elevado. Conclui-se, então, que o valor de $K_{down} = -1$ possui um módulo bastante elevado, gerando um movimento amplo demais para as necessidades de correção.

Desejando diminuir este movimento, sugeriu-se $K_{down} = -0.4$ reduzindo em mais da metade o deslocamento provocado pelas juntas tipo joelho. Após o mesmo teste ser realizado com este novo valor, observou-se a postura do robô conforme a Figura \ref{fig:kdown04}.

\begin{figure} [!b]
	\centering
	\includegraphics[width=0.7\textwidth]{Figuras/Kdown04}
	\caption{Postura após distúrbio com $K_{down} = -0.4$}
	\label{fig:kdown04}
\end{figure}

É possível notar que este novo valor permitiu que as patas da frente aterrissagem de forma vertical, com um ângulo entre a parte de baixo das patas e a linha vertical muito próximo de zero, conforme desejado. O movimento e aterrissagem observados se enquadram perfeitamente nas necessidades do controlador e, portanto, é coerente determinar $K_{down} = -0.4$.

Portanto, ao final desta etapa podemos confirmar os valores das constantes $K_{up}$ e $K_{down}$ como 1 e -0.4, respectivamente.


\subsection{Determinação das constantes de rolagem $K_{R}$ e $K_{L}$}
Os ganhos referentes à rolagem, $K_{R}$ e $K_{L}$, foram testados em ensaios com a presença de distúrbio. Para tal, o robô foi posicionado em pé sobre o solo com todas as juntas na posição inicial. Quando o controle foi acionado, aplicou-se manualmente empurrões no robô, para a sua esquerda ou sua direita, com um intervalo de tempo entre eles. Então, é observada a resposta dos motores 1, 4, 7 e 10 e a postura do robô a cada instante para verificar sua sustentação. Baseados nessas observações, os ganhos são modificados de forma a adequar o movimento desejado das patas para a correção adequada do distúrbio. Por exemplo, se for notado que a resposta precisa ser mais rápida, aumentamos o ganho; caso se 	verifique uma sensibilidade muito elevada da resposta, diminuímos tal valor.

Como abordado na seção \ref{sentido_movimentacao} e condensado na equação (\ref{eq:ganho_condicional}), os ganhos dependem do sentido de movimentação causado pela perturbação e são iguais a zero caso o sentido não corresponda àquela junta. Portanto, as quantidades aqui testadas são referentes ao caso diferente de zero, ou seja, $A_{R}$ e $A_{L}$. No entanto, manteremos a nomenclatura como $K_R$ e $K_L$ para melhor identificação do que estas variáveis representam.

Inicialmente, foi realizado tal ensaio com o distúrbio apenas para a direita, ou seja, foram aplicados empurrões na direção que pudesse fazer o robô tombar para a direita. O valor de $K_{R}$ foi inicialmente configurado para 1 e as respostas obtidas com este valor podem ser observadas na Figura \ref{fig:queda_roll_1}.

\begin{figure}[!b]
	\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_1}}\quad\quad
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_2}}}
	\caption{Teste de Queda para a direita com $K_{R} = 1$}
	\label{fig:queda_roll_1}
\end{figure}

Podemos observar neste dados, que diversos distúrbios foram aplicados em intervalos de aproximadamente 2 segundos entre eles, com uma amplitude, em módulo, de até 0.85 rad/s. Em grande parte das respostas subsequentes, percebe-se que o ângulo de rolagem volta ao seu valor inicial assim como a velocidade volta a ser de 0 rad/s, indicando a estabilidade. No entanto, o último distúrbio verificado causa a instabilidade do robô, como pode ser visto na Fig. \ref{fig:queda_roll_1}(a). Neste caso, o ângulo de rolagem cai para aproximadamente $30^o$, indicando a queda do robô.

Além disso, a Fig. \ref{fig:queda_roll_1}(b) indica que as velocidades dos motores (em amarelo) estavam bem reduzidas neste experimento e, portanto, quase não responderam ao distúrbio. Dessa forma, pode-se concluir que a estabilização dos primeiros distúrbios não teve relação com a resposta dos motores, mas sim com a própria geometria de distribuição das patas e da magnitude do distúrbio, insuficiente para fazê-lo cair. Apenas o último empurrão imposto na plataforma teve magnitude suficiente para fazê-lo cair e, como as respostas dos motores estavam em patamares insuficientes, a queda do robô ocorreu.

Portanto, o ganho de $K_{R}$ foi insuficiente para corrigir o distúrbio indicando uma necessidade de aumentar tal valor para que o controle possa responder adequadamente a tal. O próximo valor a ser testado neste mesmo experimento é de $K_{R} = 1.5$. Os dados referentes a este valor se encontram na Figura \ref{fig:queda_roll_2}.


\begin{figure}[t]
	\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_3}}\quad\quad
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_4}}
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_5}}}
	\caption{Teste de Queda para a direita com $K_{R} = 1.5$}
	\label{fig:queda_roll_2}
\end{figure}

Neste caso, foram aplicados dois distúrbios maiores em aproximadamente 7.5 e em 15 segundos e um menor em 6 segundos. Nota-se, na Fig. \ref{fig:queda_roll_2}(b), que as respostas dos motores se encontram bem mais significativas do que no experimento anterior. Nesta situação, o ângulo de rolagem chega em valores de até $15^o$ (Fig. \ref{fig:queda_roll_2}(a)) e retornam à sua posição inicial e velocidade zero. Isto foi possível devido à ação de resposta dos motores, que se deslocaram com uma velocidade suficiente para corrigir a perturbação e impedir a queda do robô. Assim, pode-se estabelecer que o valor de 1.5 foi bastante adequado para a correção da estabilidade no sentido de rolagem para direita.

Em uma análise mais detalhada da Fig. \ref{fig:queda_roll_2}(a), constata-se que, ao final do último distúrbio, os ângulos de rolagem e arfagem se acomodam em valores ligeiramente diferente do valor inicial. Isto é uma consequência do controle de estabilidade ter sido desenvolvido, até o presente experimento, sem a consideração do retorno à posição inicial. Deste modo, as patas, após corrigirem a perturbação, continuam na mesma posição que terminaram o movimento de correção. Em outras palavras, a posição de cada pata em regime permanente é dada pela posição que ela atinge ao final do deslocamento de correção. Isto faz com que os ângulos de rolagem e arfagem possam se acomodar em valores distintos do inicial.

Podemos observar melhor este fenômeno através da Figura \ref{fig:roboreal1}, que ilustra o momento ao final do experimento, em que o robô já se estabilizou mas manteve a posição fixa ao invés de voltar à posição inicial. É perceptível que o robô tem as patas dispostas para os lados enquanto sua posição inicial é com as quatro patas perpendiculares à base.

\begin{figure} [!b]
	\centering
	\includegraphics[width=0.6\textwidth]{Figuras/robo_real1}
	\caption{Posição do robô após a correção do distúrbio}
	\label{fig:roboreal1}
\end{figure}

Por fim, podemos notar na Fig. \ref{fig:queda_roll_2}(c), que o distúrbio aplicado não teve componentes apenas no movimento de rolagem conforme desejado, mas também foi aplicado na direção de arfagem. No entanto, este movimento não influenciou a análise da rolagem, uma vez que não gerou a queda do robô e o movimento de rolagem pode ser caracterizado de forma independente.

Devido à simetria da plataforma e do fato de estarmos utilizando os mesmos motores, consideraremos que $K_L$ será também igual a 1.5. Mais ao final deste capítulo será apresentado um experimento em que todas as direções são testadas com os valores de $K_i$ determinado para todos os motores.

\subsection{Determinação dos ganhos de arfagem $K_{B}$ e $K_{F}$}

Para determinar os ganhos $K_{B}$ e $K_{F}$ seguiu-se os mesmos procedimentos descritos anteriormente para o caso da rolagem. Isto é, o robô será posicionado sobre o chão na posição inicial e, após a ativação do sistema de controle, serão aplicadas perturbações para frente e para trás do robô. Em seguida, os dados serão analisados para verificar a necessidade de aumentar os ganhos, caso a resposta esteja muito lenta, ou diminuí-lo em caso de uma sensibilidade muito elevada nas respostas dos motores.

O primeiro teste foi feito para a aquisição de $K_{F}$. Apesar das dimensões longitudinais do robô serem maiores do que suas extensões transversais (o robô tem base retangular), é razoável admitir inicialmente o ganho como 1.5, valor este que garantiu uma resposta adequada no movimento de rolagem. Alterações finas podem ser requeridas caso o experimento com este valor não seja conveniente, mas assume-se que esta quantia deva ter uma ordem de grandeza semelhante à necessária para a estabilização do distúrbio da arfagem.

Os resultados obtidos neste experimento são ilustrados na Figura \ref{fig:queda_pitch1}. Podemos observar na Fig. \ref{fig:queda_pitch1}(c) que os motores responderam bem aos distúrbios impostos, com uma magnitude levemente maior que as próprias perturbações. Na Fig \ref{fig:queda_pitch1}(a), por sua vez, podemos observar que o experimento termina com os valores dos ângulos não tão próximos de zero, como se esperaria para um posição horizontal da base do robô (os valores finais são cerca de 6 graus na arfagem e 1 grau na rolagem). Contudo, isto indica apenas que, após a correção do distúrbio, o robô permaneceu na posição do final do movimento, não havendo o retorno à sua posição inicial. Neste caso, não houve queda do robô, caso em que tais ângulos estariam na faixa de pelo menos 20 graus.

\begin{figure}[b]
	\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Pitch_F_1}}\quad\quad
		\subfigure[Velocidade de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Pitch_F_2}}
		\subfigure[Velocidade de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Pitch_F_3}}}
	\caption{Teste de Queda para a frente com $K_{F} = 1.5$}
	\label{fig:queda_pitch1}
\end{figure}

O distúrbio foi, dessa forma, corrigido e a plataforma se manteve equilibrada conforme desejado. A resposta dos motores durante a correção se mostrou, então, conveniente para os propósitos deste trabalho e, assim, firmou-se que $K_F = 1.5$ sem a necessidade de alteração.

Assim como foi feito para o caso da rolagem, podemos generalizar o valor obtido para a arfagem no sentido para frente e aplicá-lo também às respostas traseiras. Dessa forma, $K_B = 1.5$.

Por fim, é apresentado um último experimento com o controlador proposto. Neste teste, todas as direções e sentidos são perturbados e todos os ganhos aqui determinados são aplicados para fornecer a resposta a este estímulo. Tal procedimento gerou os dados expressos na Figura \ref{fig:queda_todos}.

\begin{figure}[!b]
	\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Todos1}}\quad\quad
		\subfigure[Velocidade de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Todos2}}
		\subfigure[Velocidade de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Todos3}}}
	\caption{Teste de Queda em todos os sentidos}
	\label{fig:queda_todos}
\end{figure}

Podemos observar que ao final do experimento, o robô manteve-se equilibrado, sem queda. Os valores encontrados de $K_i$ se mostraram eficientes na correção do distúrbio para todos os sentidos de movimentação.

Como já observado anteriormente, nota-se que os ângulos finais de rolagem e arfagem não estão próximos de zero indicando uma leve inclinação causada pela postura do robô ao final do experimento. Como não há qualquer controle implementado, neste caso, que o faça voltar para uma certa posição, esta é determinada pela última postura aplicada para corrigir o distúrbio. Portanto, há ainda a necessidade de se implementar um sistema que faça a plataforma retornar a um valor desejado após o distúrbio.


\section{Paralelismo com a Posição Desejada}
Na seção anterior determinou-se todas as constantes de velocidade $K_i$ e, com isso, foi possível obter um controle de estabilidade satisfatório que corrigia o movimento do robô face a um distúrbio externo aplicado. No entanto, conforme foi mencionado, uma vez que o robô retornava à condição de estabilidade, as patas não voltavam à posição inicial. Este comportamento não é adequado considerando o cenário em que o robô se estabiliza ao mesmo tempo que mantém uma marcha constante. Neste caso, é desejado que, uma vez corrigido o distúrbio, o robô continue a se movimentar normalmente.

Com isso em mente, foi proposto e implementado o controle com paralelismo como explicado na seção \ref{sec:paralelismo}. Esta seção, por sua vez, realizará os testes do controle proposto. Em um primeiro momento, o controlador foi testado com a posição desejada para cada motor em regime permanente configurada para a posição inicial. Desta forma, espera-se que robô seja capaz de corrigir o distúrbio e voltar para a posição inicial, permanecendo parado a partir daí. Se os testes forem bem sucedidos, adicionar-se-á a marcha desenvolvida em \cite{tcc:porphirio:2017} para determinar a posição em regime permanente.

\subsection{Determinação das constantes $\tau_d$ e $\tau_p$}
Na nova concepção do controle de estabilidade, com paralelismo, duas novas constantes surgiram para serem determinadas, isto é, $\tau_d$ e $\tau_p$. A primeira é a constante de tempo da resposta ao distúrbio do controle de equilíbrio enquanto a segunda é a constante de tempo para que cada junta retorne à posição desejada. Estas constantes também serão determinadas empiricamente através de testes na plataforma.

Tais valores não podem ser muito elevados, caso contrário, a resposta do sistema será muito lenta, prejudicando a resposta ao distúrbio (no caso de $\tau_d$) e o retorno à posição desejada assim como as possíveis marchas a ela relacionada (no caso de $\tau_p$). Da mesma forma, não deseja-se que tais valores sejam muito reduzidos pois a resposta poderia ser muito repentina, gerando mais instabilidade e oscilações. Por esse motivo, é preciso observar o comportamento do sistema a diversos valores para, então, configurar tais constantes com a quantidade mais adequada.

Para determinar empiricamente tais constantes, realizou-se diversos testes com distúrbios na plataforma, como nos testes anteriores, para diferentes valores de $\tau_d$ e $\tau_p$. A determinação de qual valor é mais adequado foi, então, baseado no tempo para as respostas retornarem aos patamares de referência e a oscilação da resposta (considerando o pior caso).

\subsubsection{Determinação de $\tau_d$}

Como a correção ao distúrbio é mais crítica do que a resposta em regime permanente, começou-se com os teste para determinar $\tau_d$. Para tal, configurou-se $\tau_p$ como igual a 1. Nestes testes foram impostas perturbações tanto na rolagem quanto no arfagem, e a análise a ser feita deve ser com relação ao comportamento destes ângulos frente à resposta de correção dos motores.

Como $\tau_d$ representa a resposta ao distúrbio, é razoável pensar que ele deve assumir valores mais reduzidos, uma vez que o distúrbio deve ser corrigido mais rapidamente do que a posição deve convergir à desejada. Dessa forma, os valores testados para $\tau_d$ foram 0.01, 0.05, 0.1 e 0.3.

Para $\tau_d = 0.01$, obtivemos as respostas da Figura \ref{fig:taud_0.01}. Os dados para esta concepção do controlador são fornecidos em posição, ao invés de velocidade, e por esse motivo tem um formato diferente dos anteriores. Na Fig. \ref{fig:taud_0.01}(a) é apresentado o sinal de distúrbio na direção de rolagem enquanto a Fig. \ref{fig:taud_0.01}(b) ilustra a arfagem. Na determinação de $\tau_d$ omitiremos os dados referentes às posições dos motores para auxiliar na visualização dos gráficos e na análise dos resultados, uma vez que esta será feita com base nas características da correção do distúrbio.

\begin{figure}[t]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taud_001R}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taud_001F}}}
	\caption{Teste de Queda com $\tau_d = 0.01$}
	\label{fig:taud_0.01}
\end{figure}

Neste caso os dados de rolagem e arfagem foram obtidos em procedimentos distintos, mas sem impactos para a análise a ser realizada. Podemos observar pela Fig. \ref{fig:taud_0.01}(a), que a perturbação de rolagem demorou cerca de 8 segundos (de 26s a 34s) para ser corrigida, enquanto a de arfagem, na Fig. \ref{fig:taud_0.01}(b), demorou cerca de 3 segundos (de 15s a 18s).

Além disso, percebe-se uma oscilação duradoura do distúrbio de rolagem, que permanece por 5 segundo em patamares iguais a aproximadamente 1/3 do valor máximo da perturbação. A arfagem, por sua vez, não apresenta muita oscilação, caindo para o valor de referência como um sistema super-amortecido.

Para $\tau_d = 0.05$, obteve-se as respostas ilustradas na Figura \ref{fig:taud_0.05}. Estes resultados apontam para uma característica mais amena de resposta. Na Fig. \ref{fig:taud_0.05}(a), observa-se que o maior distúrbio aplicado na rolagem é corrigido em aproximadamente 5 segundos e com uma oscilação pequena quando comparada com o valor máximo, uma vez que a oscilação se dá com uma magnitude menor que 1/4 da perturbação máxima. Outra perturbação menor aplicada posteriormente é corrigida em 3.5 segundos com uma mínima oscilação.

\begin{figure}[b]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taud_005_R}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taud_005_P}}}
	\caption{Teste de Queda com $\tau_d = 0.05$}
	\label{fig:taud_0.05}
\end{figure}

Da mesma forma, na arfagem observada na Fig. \ref{fig:taud_0.05}(b), a maior perturbação detectada é corrigida em 1.8 segundos com uma oscilação um pouco maior, mas que decai rapidamente.

Portanto, as respostas obtidas para $\tau_d = 0.05$ se mostraram bastante satisfatórias, com um tempo de resposta adequado para a correção do distúrbio e sem a presença de oscilações muito elevadas que possam prejudicar a marcha do robô.

Para $\tau_d = 0.1$ a resposta obtida é dada pela Figura \ref{fig:taud_0.1}. Neste caso, nota-se que o distúrbio na rolagem sofre oscilações que perduram por aproximadamente 6 segundos sem serem amortecidas. Na arfagem, a perturbação passa a ser corrigida em 2.5 segundos.

\begin{figure}[t]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taud_010_R}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taud_010_P}}}
	\caption{Teste de Queda com $\tau_d = 0.1$}
	\label{fig:taud_0.1}
\end{figure}

Por fim, para $\tau_d = 0.3$, obtivemos os dados ilustrados na Figura \ref{fig:taud_0.3}. Neste caso, nota-se que a correção do distúrbio na rolagem (Fig. \ref{fig:taud_0.3}(a)) se prolonga por aproximadamente 10 segundos enquanto a arfagem também alcança este número, como pode ser visto na Fig. \ref{fig:taud_0.3}(b)

\begin{figure}[b]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taud_030_R}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taud_030_P}}}
	\caption{Teste de Queda com $\tau_d = 0.3$}
	\label{fig:taud_0.3}
\end{figure}

Para condensar as informações aqui apresentadas, construiu-se a Tabela \ref{Tabtaud}, que descreve, para cada $\tau_d$ testado, os valores de tempo de acomodação e magnitude da oscilação, considerando o pior caso atingido tanto para rolagem quanto para arfagem. Para determiná-los, consideramos tempo de acomodação como o tempo de início do distúrbio até o momento em que ele volta a 0 graus e assim permanece por 2 segundos (10 tempos de amostragem) e a magnitude de oscilação como o valor do segundo maior pico do distúrbio, em módulo, normalizado pelo maior valor atingido.
	
Observa-se que, de modo geral, a direção de rolagem sofre com mais oscilações. Isto pode ser explicado pelo comprimento reduzido da base do robô nesta dimensão (menor lado do retângulo) o que gera uma margem de estabilidade estática menor.

Podemos observar pela tabela, que o valor de $\tau_d$ que gera um menor tempo de acomodação, tanto na rolagem quanto na arfagem é 0.05 segundos. Além disso, este valor também gera o melhor comprometimento entre a magnitude de oscilação de rolagem e de arfagem uma vez que apresenta o menor valor da primeira e o segundo menor valor da segunda. Portanto $\tau_d = 0.05$.

\subsubsection{Determinação de $\tau_p$}
Com o parâmetro $\tau_d$ determinado pode-se realizar os testes para a obtenção de $\tau_p$. Este foi utilizado até então como igual a 1 para que fosse determinado o tempo de resposta ao distúrbio. Agora, testaremos o mesmo cenário, i.e. a resposta da plataforma a perturbações na direção de rolagem e de arfagem, para determinar o valor de $\tau_p$ mais adequado para que as posições de cada junta voltem à posição desejada.

\begin{table}[t]
	\caption{Tempo de Acomodação e Magnitude de Oscilação em testes de $\tau_d$}
	\label{Tabtaud}
	\begin{center}
		\begin{tabular}{|c|c|c|c|c|}
			\hline
			& \multicolumn{2}{|c|}{Tempo de Acomodação} & \multicolumn{2}{|c|}{Magnitude de Oscilação} \\
			\hline
			$\tau_d$	& Rolagem & Arfagem & Rolagem & Arfagem \\ \hline
			0.01 & 8.4 & 3.6 & 0.729 & 0.109\\
			0.05 & 5.2 & 1.8 & 0.249 & 0.436\\
			0.1 & 6.4 & 2.8 & 0.999 & 0.250\\
			0.3 & 10 & 10.2 & 0.412 & 0.814\\ \hline
		\end{tabular}
	\end{center}
\end{table}


Como anteriormente, a posição desejada é configurada para a posição inicial de forma que o robô fique parado em regime permanente. Uma vez que a constante $\tau_d$ já foi determinada, utilizaremos tal valor para a realização dos testes. Os valores de $\tau_p$ a serem testados são: 0.1, 0.3, 0.5 e 0.7. Estes valores foram escolhidos pois a resposta em regime permanente não necessita ser tão rápida quanto a correção do distúrbio. 

A análise das respostas será feita com base no tempo de acomodação, uma vez que não foram observadas oscilações significativas nas juntas que pudessem gerar adversidades. O tempo de acomodação é aqui definido como o maior tempo entre o início do movimento de alguma junta e o instante em que sua posição entra e se mantém, por 2 segundos, na faixa de mais ou menos 2\% do seu valor inicial5.

O primeiro valor a ser testado foi de $\tau_p = 0.1$ e a resposta obtida é ilustrada na Figura \ref{fig:taup_0.1}. Na Fig. \ref{fig:taup_0.1}(a) apresenta-se os ângulos dos quatro motores de correção da rolagem sendo, em amarelo, os da esquerda e em azul, os da direita. Na Fig. \ref{fig:taup_0.1}(b), são ilustrados os ângulos dos 8 motores de rolagem sendo, em amarelo os correspondentes da frente, e em azul, os de trás.

\begin{figure}[t]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taup_01R}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taup_01P}}}
	\caption{Teste de Queda com $\tau_p = 0.1$}
	\label{fig:taup_0.1}
\end{figure}

Observando a resposta da rolagem, notamos que o maior valor do tempo de acomodação foi de 2.9 segundos enquanto, na arfagem, este valor foi de 8.8 segundos.

Para $\tau_p = 0.3$ obteve-se o resultado da Figura \ref{fig:taup_0.3}. Neste caso, podemos observar uma resposta, na rolagem, de 2.8 segundos para que o sistema volta à posição inicial. Já na arfagem este valor é de 3 segundos.

\begin{figure}[!b]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taup_03R}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taup_03P}}}
	\caption{Teste de Queda com $\tau_p = 0.3$}
	\label{fig:taup_0.3}
\end{figure}

Para $\tau_p = 0.5$, as respostas dos motores pode ser visualizada através da Figura \ref{fig:taup_0.5}. Nela, percebemos que o valor de maior tempo de resposta na direção da rolagem é de 2.5 segundos. No entanto, para a arfagem percebeu-se que tal valor era de 9.1 segundos.

\begin{figure}[t]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taup_05R}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taup_05P}}}
	\caption{Teste de Queda com $\tau_p = 0.5$}
	\label{fig:taup_0.5}
\end{figure}

Por fim, para $\tau_p = 0.7$ obteve-se a resposta indicada pela Figura \ref{fig:taup_0.7}. Neste caso, o tempo de acomodação da resposta à rolagem foi de 6.7 segundos enquanto da arfagem foi de 6.2 segundos.

\begin{figure}[!b]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taup_07R}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/taup_07P}}}
	\caption{Teste de Queda com $\tau_p = 0.7$}
	\label{fig:taup_0.7}
\end{figure}

Portanto, podemos condensar as informações obtidas acima na Tabela \ref{Tabtaup}. Analisando os valores comparativamente, nota-se que o cenário com melhor comprometimento entre as resposta de rolagem e arfagem é $\tau_p = 0.3$. Este valor apresenta o menor tempo de acomodação da arfagem e segundo melhor da rolagem. Dessa forma, o robô apresenta uma resposta adequada ao desejado, retornando à posição inicial rapidamente. Portanto, $\tau_p = 0.3$.


\subsection{Testes finais}

Com todos os $K_i$ determinados assim como todas as constantes de tempo $\tau_d$ e $\tau_p$, o controle de equilíbrio com paralelismo se encontra completo. Dessa forma, é possível testar perturbações em todas as direções e sentidos da plataforma e espera-se que a correção seja realizada de forma adequada, assim como a retorno à posição inicial.

Desta maneira, foram aplicados distúrbios para os quatro sentidos individualmente e analisados os resultados advindos destes procedimentos. Ao final será realizado um último teste com distúrbios aplicados em diagonal de modo a obter uma resposta conjunta da rolagem e da arfagem.

O primeiro teste foi realizado na direção de rolagem, para a direita. Os dados referentes a este caso são ilustrados na Figura \ref{fig:queda_final_direita}.


A Fig. \ref{fig:queda_final_direita}(a) apresenta, em amarelo, a posição dos motores que corrigem a rolagem da esquerda, em azul, os da direita e, em vermelho, o distúrbio lido pelo acelerômetro, em graus. A Fig. \ref{fig:queda_final_direita}(b), por sua vez, retrata o comportamento do ângulo de arfagem, em vermelho, e dos motores a ele relacionado, sendo em amarelo os motores da frente e em azul, os de trás.

Nesta imagem, podemos observar que todos os motores respondem de forma bem sincronizada à perturbação, de forma que os dois motores da direita apresentam uma curva de resposta muito similar, assim como os da esquerda também estão em sintonia. 

Da mesma forma, é possível notar que, mesmo que a perturbação tenha sido realizada para a direita, os dois lados apresentaram alguma resposta. Isto se deve ao fato de que o movimento criado pelo distúrbio gera uma oscilação no robô, isto é, este é inicialmente lançado para a direita, mas após a correção pelas patas neste sentido, a plataforma tende a se movimentar para a esquerda e assim por diante até que o movimento seja amortecido pelo controlador. É possível observar essa oscilação através da linha vermelha da Fig. \ref{fig:queda_final_direita}(a) representando o distúrbio oscilante.

\begin{table}[t]
	\caption{Tempo de Acomodação em testes de $\tau_p$}
	\label{Tabtaup}
	\begin{center}
		\begin{tabular}{|c|c|c|}
			\hline
			& \multicolumn{2}{|c|}{Tempo de Acomodação} \\
			\hline
			$\tau_d$	& Rolagem & Arfagem \\ \hline
			0.1 & 2.9 & 8.8 \\
			0.3 & 2.8 & 3 \\
			0.5 & 2.5 & 9.1\\
			0.7 & 6.7 & 6.2 \\ \hline
		\end{tabular}
	\end{center}
\end{table}

\begin{figure}[!b]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/final_direita}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/final_direita2}}}
	\caption{Teste de Queda para a direita com Paralelismo}
	\label{fig:queda_final_direita}
\end{figure}

Após a correção do distúrbio e o fim da oscilação do robô, notamos que as juntas voltam à posição inicial. Conforme havia sido concebido, o controle com paralelismo foi capaz não apenas de corrigir o distúrbio externo, como também de retornar à posição desejada para o regime permanente.

Neste experimento, quase não houve movimentação na direção da rolagem, com exceção de uma pequena perturbação por volta dos 16 segundos, provavelmente consequência de uma irregularidade no momento da aplicação do distúrbio, mas que não foi significativa para causar influência no experimento.

O mesmo procedimento foi realizado com os distúrbios para a esquerda, resultando nos dados da Figura \ref{fig:queda_final_esquerda}. Nota-se que esta resposta é bem similar ao obtido na Fig. \ref{fig:queda_final_direita}, mesmo que as perturbações tenham sido aplicadas no sentido oposto. Isto se deve à mesma oscilação descrita anteriormente que acaba gerando movimento tanto para a direita quanto para a esquerda. Deste modo, as resposta de todos os motores se faz necessária para o amortecimento do deslocamento de rolagem.

\begin{figure}[t]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/final_esquerda}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/final_esquerda2}}}
	\caption{Teste de Queda para a esquerda com Paralelismo}
	\label{fig:queda_final_esquerda}
\end{figure}


Já para a direção de arfagem realizou-se, primeiramente, o teste com o distúrbio para a frente, resultando nos dados apresentados pela Figura \ref{fig:queda_final_frente}. A Fig. \ref{fig:queda_final_frente}(b) apresenta, em amarelo, as posições das juntas da parte da frente do robô que corrigem a arfagem. A curva em azul representa os motores de trás e, em vermelho, o distúrbio apresentado.

\begin{figure}[!b]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/final_frente1}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/final_frente2}}}
	\caption{Teste de Queda para frente com Paralelismo}
	\label{fig:queda_final_frente}
\end{figure}

A análise da curva do distúrbio, em vermelho, evidencia mais a oscilação do movimento de arfagem, que persiste por mais tempo até a acomodação no valor de referência. Além disso, notamos que alguns motores seguem uma orientação contrária aos outros, indicando o movimento das juntas dos joelho que se opõe aos demais motores. Neste caso, as posições das juntas também retornam à posição inicial, conforme desejado.

As respostas dos movimentos de rolagem, na Fig. \ref{fig:queda_final_frente}(a), são inferiores em magnitude e, portanto, não influenciaram neste procedimento.

Para perturbações para trás do robô, obtivemos os resultados ilustrados na Figura \ref{fig:queda_final_tras}. Novamente percebemos a semelhança com o caso anteriorer devido à oscilação do movimento na direção da arfagem. Assim, os motores tem um comportamento bem similar, de modo a amortecer tal oscilação até que o valor de referência (0 graus) seja atingido e o robô, estabilizado.

\begin{figure}[t]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/final_tras1}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/final_tras2}}}
	\caption{Teste de Queda para a trás com Paralelismo}
	\label{fig:queda_final_tras}
\end{figure}

Por fim, realizou-se um experimento com distúrbios aplicados em diagonal, para poder analisar a resposta conjunta da direção da rolagem e da arfagem. As respostas obtidas podem ser visualizadas pela Figura \ref{fig:queda_final_diagonal}.

\begin{figure}[!b]
	\centering
	\mbox{
		\subfigure[Ângulos de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Diagonal1}}\quad\quad
		\subfigure[Ângulos de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Diagonal2}}}
	\caption{Teste de Queda para na diagonal com Paralelismo}
	\label{fig:queda_final_diagonal}
\end{figure}

Podemos observar a similaridade da resposta obtida com os experimentos anteriores, isto é, os motores respondem em conjunto para corrigir o distúrbio retornando ao final de cada perturbação aos seus valores iniciais. Os distúrbios, por sua vez, é amortecido com oscilações até que atinge o valor de referência. Dessa forma, conclui-se que o controle de estabilidade desenvolvido é capaz de responder adequadamente às perturbações aplicadas, mesmo que em diagonal e retornar às posições iniciais.

\section{Conclusões}
O controle de estabilidade proposto no capítulo \ref{CapDesenvolvimento} foi pensado com base em uma análise empírica, isto é, composta de testes reais na plataforma e da construção de um controlador em paralelo com os experimentos. Isto se reflete, desde a concepção inicial do projeto, na determinação dos ganhos $K_i$, proposta para ser realizada empiricamente com base nas respostas reais dos motores durante a correção de um distúrbio

No entanto, a abordagem inicial teve que sofrer algumas modificações para se adequar ao cenário encontrado no quadrúpede. Devido especialmente à limitação do torque no modo velocidade, foi necessária a mudança para o modo posição, mas mantendo a concepção de que a velocidade de cada junta seria, basicamente, a velocidade do distúrbio vezes $K_i$. Com o novo modo de operação capaz de sustentar o robô nas condições de repouso, foi possível aplicar testes com o controlador proposto e, concomitantemente, adequar os ganhos $K_i$ até que se observasse a melhor resposta às perturbações.

Descobertos os valores dos ganhos que melhor corrigem os distúrbios, estávamos em posse de um controlador efetivamente capaz de manter a plataforma equilibrada a perturbações externas. No entanto, ainda era necessário aliar o controle proposto ao desenvolvimento de marchas para que o robô conseguisse se equilibrar durante a caminhada sem prejudicar a mesma. Para tal foi proposto o sistema com paralelismo.

Com o controlador em paralelo desenvolvido, foi possível realizar os testes que determinassem os valores adequados de $\tau_d$ e $\tau_p$ que resultassem em um tempo de resposta condizente com os distúrbios sofridos. Dessa forma, foi possível adequar os tempos de resposta para atingir o regime permanente e para responder ao distúrbio.

Por fim, foi possível realizar os testes finais de verificação do controle de equilíbrio, avaliando a sua capacidade de responder aos distúrbios de forma efetiva, em todas as direções e retornar à posição inicial desejada. O alinhamento com as marchas desenvolvidas em \cite{tcc:porphirio:2017}, no entanto, não foi possível de ser realizado, uma vez que as marchas se encontravam muito lentas com o tempo de amostragem proposto. Contudo, ressalta-se que esta possibilidade não foi descartada e será incluída como sugestão para trabalhos futuros no capítulo seguinte.

