%TCIDATA{LaTeXparent=0,0,relatorio.tex}
                      
\chapter{Resultados Experimentais}\label{CapExperimentos}

% Resumo opcional. Comentar se não usar.
\resumodocapitulo{Resumo opcional.}

\section{Introdução}

%Na introdução deverá ser feita uma descrição geral dos experimentos realizados. 

%Para cada experimentação apresentada, descrever as condições de experimentação (e.g., instrumentos, ligações específicas, configurações dos programas), os resultados obtidos na forma de tabelas, curvas ou gráficos. Por fim, tão importante quando ter os resultados é a análise que se faz deles. Quando os resultados obtidos não forem como esperados, procurar justificar e/ou propor alteração na teoria de forma a justificá-los.

Como foi abordado no Capítulo \ref{CapDesenvolvimento}, o desenvolvimento do projeto sofreu modificações com relação à concepção inicial do controle de estabilidade. As principais mudanças, assim como a determinação dos coeficientes de resposta dos motores, foram baseadas em testes reais na plataforma, que serão mostrados e analisados neste capítulo.

Os experimentos consistiram na execução do programa elaborado para cada etapa do desenvolvimento do controle com o robô nos seguintes cenários: sustentado por uma caixa, sem contato das patas com o solo; com o robô em pé se sustentando, mas sem nenhum distúrbio e sendo empurrado para a esquerda, direita, para frente ou para trás.

Após cada experimento, os dados eram recolhidos e analisados através do software \emph{Matlab}. Os gráficos que serão apresentados neste capítulo foram obtidos por tal programa.

\section{Modo Velocidade}
A primeira abordagem do controle de estabilidade foi a utilização dos motores no modo velocidade. Nesta seção serão apresentados os principais resultados obtidos neste modo de operação e analisadas as suas consequências para o controle de estabilidade.

\subsection{Medição}
O primeiro elemento a ser testado é a medição dos ângulos pelo acelerômetro. Além disso, pode-se obter a velocidade dos ângulos de rolagem e arfagem através da derivação e observar os efeitos do filtro passa-baixa desenvolvido.

O teste é feito com o robô parado, sustentado por uma caixa que impede as patas de entrarem em contato com o solo, sem a adição de qualquer distúrbio e com a resposta dos motores desativada. Dessa forma, é possível observar o ruído produzido durante a medição, uma vez que os dados de velocidade, em um cenário ideal, deveriam ser iguais a zero e os ângulos, sempre constantes. Podemos observar a medição destes na Figura \ref{fig:angulos_ruido}.


Os ângulos iniciam o teste com os valores iniciais de zero graus, devido à inicialização da conexão com o \emph{Arduino}. No entanto, após 6 períodos de amostragem (ou 1.2 segundos) a aquisição de dados é estabelecida. A partir de então, podemos notar que os dados sofrem variações devido ao ruído. Utilizando os comandos \emph{max}, \emph{min} e \emph{mean} do \emph{Matlab} podemos identificar os ângulos mínimo, máximo e médio atingidos para cada medição. Tais valores são apresentados na Tabela \ref{TabAngulos}. 

Podemos observar que o valor médio das duas quantidades é diferente de zero, apesar de muito próximos deste valor, indicando uma pequena inclinação da superfície em que o robô é instalado. A variação de cada ângulo medido a cada período de amostragem é um efeito do ruído de medição, caracterizado por altas frequências.

Após a medição, os ângulos são derivados e, em seguida, passados por um filtro passa-baixa, especificado pela equação \ref{eq:filtro}. As velocidades resultantes após a derivação e após a filtragem podem ser visualizadas na Figura \ref{fig:velocidades_medidas}. Para poder analisar o efeito do filtro sobre a velocidade calculada, montou-se a Tabela \ref{TabVelocidades}. Nela foram organizados os valores mínimo, máximo e médio das velocidades assim como sua amplitude, ou seja, a diferença entre o máximo e o mínimo atingidos.

Dessa forma, podemos observar que, com a inclusão do filtro, a amplitude do ruído decaiu 45.7\% para a medição da velocidade de rolagem e 52.5\% para a arfagem. Isso indica que o efeito do filtro sob a medição da velocidade se mostrou adequado para as necessidades para as quais ele foi desenvolvido. Isto é, ele é capaz de amenizar a ação do ruído em altas frequências.

Por fim, pode-se observar que o valor médio das velocidades obtidas encontra-se na ordem de $10^{-4}$ e $10^{-5}$ e, dessa forma, reduzidos o bastante para serem considerados próximos de zero. Como será visto mais adiante, um distúrbio no sentido de rolagem, por exemplo, permanece na ordem de $10^{0}$ e $10^{1}$ rad/s.

\begin{figure} [h]
	\centering
	\includegraphics[width=0.6\textwidth]{Figuras/Angulos_ruido}
	\caption{Ângulos de Rolagem e Arfagem medidos com o robô parado}
	\label{fig:angulos_ruido}
\end{figure}

\begin{table}[t]
	\caption{Ângulos mínimo, máximo e médio medidos}
	\label{TabAngulos}
	\begin{center}
		\begin{tabular}{|c|c|c|c|}
			\hline
			\textbf{Orientação} & \textbf{Valor mínimo (graus)} & \textbf{Valor máximo (graus)} & \textbf{Valor médio (graus)} \\
			\hline
			Rolagem & 0.6663 & 1.3429 & 0.9947\\
			Arfagem & -0.3531 & 0.3237 & -0.0849\\ \hline
		\end{tabular}
	\end{center}
\end{table}

\subsection{Teste de Sustentação} \label{sec:sustentacao_velocidade}
Com as medições realizadas, os procedimentos seguintes envolvem o robô parado, sustentado pelas suas próprias patas e sem a aplicação de nenhum distúrbio externo. Para tal, o sistema implementado, inicialmente, impõe as posições iniciais de cada motor de modo que o robô fique na postura adequada. Em seguida, a plataforma é posicionada no solo e nenhum distúrbio (e.g. empurrão) é aplicado. Este experimento foi realizado, para fins de comparação, tanto para o controle desenvolvido para o modo velocidade, caracterizado pela equação \ref{eq:controle_velocidade_discreto}, como para o controle adaptado para o modo posição, determinado pela equação \ref{eq:controle_posicao_discreto}.


O resultado obtido no modo velocidade pode ser visualizado pela Figura \ref{fig:teste_sustentacao}. Na Fig. \ref{fig:teste_sustentacao}(a) são mostrados os ângulos de rolagem e arfagem medidos. Já a Fig. \ref{fig:teste_sustentacao}(b) apresenta, em vermelho, a velocidade de rolagem e, de amarelo, a velocidade dos motores utilizados para corrigir o distúrbio nesta direção (i.e. motores 1, 4, 7 e 10). Analogamente, a Fig. \ref{fig:teste_sustentacao}(b) contém a velocidade de arfagem e dos respectivos motores que a corrigem.

Podemos notar uma grande movimentação entre os instantes 1 e 3 segundos mas que se devem apenas à alocação do robô sobre o solo. A partir deste momento, nenhum distúrbio externo foi aplicado ao robô. Ainda assim, é possível observar, na Fig. \ref{fig:teste_sustentacao}(a), que o robô sofre uma queda, a partir de aproximadamente 8 segundos, quando o ângulo de arfagem caiu para -18.3127 graus. \\

\begin{figure}[h]
	\centering
	\mbox{
		\subfigure[Velocidade de Rolagem]{\includegraphics[width=0.5\textwidth]{Figuras/Filtro_roll}}\quad\quad
		\subfigure[Velocidade de Arfagem]{\includegraphics[width=0.5\textwidth]{Figuras/Filtro_pitch}}}
	\caption{Velocidades antes e depois da filtragem}
	\label{fig:velocidades_medidas}
\end{figure}

\pagebreak

\begin{table}[t]
	\caption{Velocidades mínima, máxima, média e sua amplitude}
	\label{TabVelocidades}
	\begin{center}
		\begin{tabular}{c|c|c|c|c}
			\hline
			\textbf{Orientação} & \textbf{Mínimo (rad/s)} & \textbf{Máximo (rad/s)} & \textbf{Amplitude (rad/s)} & \textbf{Média (rad/s)} \\
			\hline
			Rolagem & -0.0581 & 0.1172 & 0.1753 & $7.0738*10^{-4}$\\
			Rolagem filtrada & -0.0299 & 0.0952 & 0.0653 & $7.0598*10^{-4}$\\
			Arfagem & -0.0399 & 0.0409 & 0.0808 & $8.3171*10^{-5}$\\
			Arfagem filtrada & -0.0184 & 0.0384 & 0.02 & $2.9474*10^{-5}$\\ \hline
		\end{tabular}
	\end{center}
\end{table}

\begin{figure}[b]
	%\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_velocidade1}}\quad\quad
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_velocidade2}}
		\subfigure[Velocidade de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_velocidade3}}}
	\caption{Teste de Sustentação do Robô}
	\label{fig:teste_sustentacao}
\end{figure}

Para analisar o ocorrido podemos verificar a Fig. \ref{fig:teste_sustentacao}(c), representando a direção em que houve a queda (i.e arfagem). Nela, as linhas em amarelo, representando as velocidades dos motores, começam a aumentar (em módulo) alguns segundos antes da queda brusca. Este é um indicador de que as juntas começaram a ceder inicialmente de forma lenta e foram aumentando sua velocidade até que o robô não foi mais capaz de se sustentar, gerando a queda.

Podemos, para melhor visualização, separar a resposta de um desses motores, como é feito na Figura \ref{fig:motor_queda}. Nesta imagem, isolou-se a resposta, em módulo, do motor 11 (utilizado para corrigir a arfagem em uma junta do tipo não joelho). Constata-se que a velocidade do motor começou a aumentar cerca de 2 segundos antes da queda do robô, atingindo o seu ápice por volta de 8.42 segundos.

\begin{figure} [tb]
	\centering
	\includegraphics[width=0.6\textwidth]{Figuras/Modo_velocidade4}
	\caption{Velocidade do Motor 11}
	\label{fig:motor_queda}
\end{figure}

Como não houve distúrbios externos e a resposta dos motores havia sido configurada para 0 rad/s, conclui-se que os motores não apresentam torque suficiente no modo velocidade para mantê-la como tal e, consequentemente, deixam as juntas suscetíveis a serem movimentadas. O resultado disso foi o peso do robô movimentar as juntas até o ponto em que este não foi capaz de se sustentar mais.

No entanto, não foi encontrado o motivo pelo qual os motores apresentam um torque limitado no modo velocidade. Pode-se salientar que os motores foram configurados para apresentarem o torque máximo possível. Para tal, os bytes 14 e 15 da memória de cada motor definem o torque máximo permitido e, os bytes 34 e 35, o limite de torque que se deseja implementar. Nos dois casos foram aplicados os maiores valores possíveis para garantir que não houvesse limitações de torque. Ainda assim, os testes no modo velocidade apresentaram as limitações verificadas anteriormente.

A hipótese formulada para tal limitação é que o modo velocidade foi desenvolvido pelos fabricantes dos motores para ser utilizado em rodas ou outros elementos que giram constantemente por várias revoluções por minuto. Enquanto isso, o modo posição teria sido desenvolvido para aplicações em articulações e juntas, como é o caso do quadrúpede, uma vez que a determinação (e fixação) das posições desejadas implica em uma resolução de movimento mais adequada para tais finalidades. Por isso, este modo apresentaria um torque mais elevado para manter as posições fixas enquanto, em rodas e afins, esta imobilização não se faz necessária.

Como será visto na próxima seção, o modo posição apresenta um torque bastante elevado quando comparado ao modo velocidade. Neste caso, ao determinar uma posição para o motor (assim como configuramos uma velocidade de 0 rad/s no modo velocidade) este fixa tal localização e não cede facilmente a movimentos externos que tendam a mover a junta para uma posição diferente. Portanto, é mais vantajoso que trabalhemos no modo posição para que o robô possa se sustentar sozinho.

\section{Modo Posição}
Com o modo posição, podemos utilizar os motores de forma mais adequada para que o robô se sustente e corrija os distúrbios aos quais está suscetível. Da mesma forma que no modo velocidade, nesta seção abordar-se-á os resultados atingidos com os experimentos no modo posição analisando o que necessita de modificação e, principalmente, obtendo os dados empíricos para a determinação das constantes de controle.

\subsection{Teste de Sustentação}
Assim como foi realizado na seção \ref{sec:sustentacao_velocidade}, neste experimento realizou-se o teste de sustentação, com o robô em pé, parado, sem aplicação de distúrbios externos e com a velocidade dos motores configurada para zero. A diferença entre o presente experimento e o item mencionado é que, neste caso, para manter a velocidade de 0 rad/s em cada motor, o sistema configura sua posição sempre com o mesmo valor enquanto, anteriormente, a própria velocidade era determinada.

Os dados obtidos para tal teste podem ser analisados na Figura \ref{fig:teste_sustentacao_posicao}. Podemos observar que o experimento foi possível de ser realizado por mais tempo que anteriormente pois não houve a queda do robô. Dessa forma, as figuras apresentadas apresentam apenas ruído, uma vez que não houve distúrbios externos e nem movimento da juntas.

\begin{figure}[b]
	%\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_posicao1}}\quad\quad
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_posicao2}}
		\subfigure[Velocidade de Arfagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Modo_posicao3}}}
	\caption{Teste de Sustentação do Robô no Modo Posição}
	\label{fig:teste_sustentacao_posicao}
\end{figure}

Desta maneira, comparando com os dados obtidos na seção \ref{sec:sustentacao_velocidade}, podemos concluir que a sustentação no modo posição é mais adequada para a plataforma do que no modo velocidade, uma vez que possibilita que o robô fique em pé parado.

\subsection{Determinação das constantes $K_{up}$ e $K_{down}$}
As constantes $K_{up}$ e $K_{down}$, no escopo de correção do movimento de arfagem, tem a finalidade de diferenciar as respostas dos motores de juntas do tipo joelho (com o ganho $K_{up}$) das demais ($K_{down}$). Como mencionado na seção \ref{sec:ganhos}, cada um deses motores terá, ainda, uma segunda componente que será a responsável pelo movimento de correção em si. Dessa forma, $K_{up}$ e $K_{down}$ são apenas ponderações da resposta para a diferenciação das juntas do tipo joelho.

Por esse motivo, considerou-se, inicialmente, que $K_{up} = 1$. Assim, podemos determinar empiricamente o ganho $K_{down}$, em conformidade com o movimento do motor de cima, para que o deslocamento da pata no sentido sagital seja tal que esta aterrisse da forma mais vertical possível como mostrado na Fig. \ref{fig:aterrissagem}(c). Assim, a correção da estabilidade do robô será determinada unicamente pelos ganhos $K_{pitch\_F}$ e $K_{pitch\_B}$, abordados mais adiante.

O teste para se determinar $K_{down}$ ocorrerá da seguinte forma: em uma das patas, aplicar-se-á uma velocidade de 0.5 rad/s por 2 segundos no motor de cima. Então, para quatro valores de $K_{down}$, definiremos a resposta da junta do tipo joelho da respectiva perna como $0.5K_{down}$ rad/s. Desse modo, a resposta do joelho será igual à velocidade do motor de cima, ponderada pelo ganho, assim como no controle proposto.

Então, observaremos a posição da pata ao final de cada experimento e defineremos $K_{down}$ com o valor que melhor ajusta a pata para aterrissagem vertical. Caso se perceba necessário, novos valores serão sugeridos e testados da mesma forma.

\subsection{Determinação das constantes $K_{roll\_R}$ e $K_{roll\_L}$}
Os ângulos referentes à rolagem, $K_{roll\_R}$ e $K_{roll\_L}$, foram testados em ensaios com a presença de distúrbio. Neste sentido, o robô é posicionado em pé sobre o solo com todas as juntas na posição inicial. Quando o controle é acionado, são aplicados manualmente empurrões no robô, para a sua esquerda ou sua direita, com um espaço de tempo entre eles. Então, é observada a resposta dos motores 1, 4, 7 e 10 e a postura do robô a cada instante para verificar sua sustentação. Baseados nessas observações, os ganhos são modificados de forma a adequar o movimento desejado das patas para a correção adequada do distúrbio, por exemplo, se for notado que a resposta precisa ser mais rápida, aumentamos o ganho; caso verifique uma sensibilidade muito elevada da resposta, diminuímos tal valor.

Inicialmente, foi realizado tal ensaio com o distúrbio apenas para a direita, ou seja, foram aplicados empurrões na direção que pudesse fazer o robô tombar para a direita. O valor de $K_{roll\_R}$ foi inicialmente configurado para 1. As respostas obtidas com este valor podem ser observadas na Figura \ref{fig:queda_roll_1}.

\begin{figure}[b]
	\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_1}}\quad\quad
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_2}}}
	\caption{Teste de Queda para a direita com $K_{roll\_R} = 1$}
	\label{fig:queda_roll_1}
\end{figure}

Podemos observar neste dados, que diversos distúrbios foram aplicados em intervalos de aproximadamente 2 segundos entre eles, com uma amplitude, em módulo, de até 0.85 rad/s. Em grande parte das respostas subsequentes, percebe-se, que o ângulo de rolagem volta ao seu valor inicial assim como a velocidade volta a ser de 0 rad/s, indicando a estabilidade. No entanto, o último distúrbio verificado causa a instabilidade do robô, como pode ser visto na Fig. \ref{fig:queda_roll_1}(a). Neste caso, o ângulo de rolagem cai para aproximadamente $30^o$, indicando a queda do robô.

Além disso, a Fig. \ref{fig:queda_roll_1}(b) indica que as velocidades dos motores (em amarelo) estavam bem reduzidas neste experimento e, portanto, quase não responderam ao distúrbio. Dessa forma, pode-se concluir que a estabilização dos primeiros distúrbios não teve relação com a resposta dos motores, mas sim com a própria geometria de distribuição das patas e da magnitude do distúrbio, insuficiente para fazê-lo cair. Apenas o último empurrão imposto na plataforma teve a magnitude suficiente para fazê-lo cair e, como as respostas dos motores estavam em patamares insuficientes, a queda do robô ocorreu.

Portanto, o ganho de $K_{roll\_R}$ foi insuficiente para corrigir tal distúrbio. Logo, fez-se necessário aumentar tal valor para que o controle possa responder adequadamente a tal. O próximo valor a ser testado neste mesmo experimento é de $K_{roll\_R} = 1.5$. Os dados referentes a este valor se encontram na Figura \ref{fig:queda_roll_2}.

\begin{figure}[b]
	\centering
	\mbox{
		\subfigure[Ângulos medidos]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_3}}\quad\quad
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_4}}
		\subfigure[Velocidade de Rolagem e dos seus motores]{\includegraphics[width=0.3\textwidth]{Figuras/Queda_Roll_R_5}}}
	\caption{Teste de Queda para a direita com $K_{roll\_R} = 1.5$}
	\label{fig:queda_roll_2}
\end{figure}

Neste caso, foram aplicados dois distúrbios maiores em aproximadamente 7.5 e em 15 segundos e um menor em 6 segundos. Nota-se, na Fig. \ref{fig:queda_roll_2}(b), que as respostas dos motores se encontram bem mais significativas do que no experimento anterior. Nesta situação, o ângulo de rolagem chega em valores de até $15^o$ (Fig. \ref{fig:queda_roll_2}(a)) e retornam à sua posição inicial e velocidade zero. Isto foi possível devido à ação de resposta dos motores.

Em uma análise mais detalhada da Fig. \ref{fig:queda_roll_2}(a), constata-se que, ao final do último distúrbio, os ângulos de rolagem e arfagem se acomodam em valores ligeiramente diferente do valor inicial. Isto é uma consequência do controle de estabilidade ter sido desenvolvido, até o presente experimento, sem a consideração do retorno à posição inicial. Deste modo, as patas, após corrigirem a perturbação, continuam na mesma posição que terminaram o movimento de correção. Em outras palavras, a posição de cada pata em regime permanente é dada pela posição que ela atinge ao final do deslocamento de correção. Isto faz com que os ângulos de rolagem e arfagem possam se acomodar em valores distintos do inicial.

Por fim, podemos notar também na Fig. \ref{fig:queda_roll_2}(c), que o distúrbio aplicado não teve componentes apenas no movimento de rolagem conforme desejado, mas também foi aplicado na direção de arfagem. No entanto, este movimento não influenciou a análise da rolagem, uma vez que não gerou queda do robô.



%Falar do teste 1: descobrir que k = 0 quando o disturbio nao foi no seu sentido
%Falar do teste 2: descobrir o valor de fato
